import folium
from folium import IFrame
import json

# æ·±åœ³å¸‚åœ°ç†è¾¹ç•Œåæ ‡ï¼ˆç²¾ç¡®åˆ°åŒºçº§ï¼‰
SHENZHEN_BOUNDS = {
    "northeast": [22.837, 114.615],  # å¤§é¹æ–°åŒº
    "southwest": [22.396, 113.756]   # å®å®‰åŒº
}

# ç§‘å¹»åˆ†ç±»æ ‡ç­¾é…ç½® - å¢å¼ºé…è‰²
SCIFI_CATEGORIES = {
    "cyberpunk": {
        "name": "èµ›åšæœ‹å…‹", 
        "color": "#00ffff", 
        "glow": "#00ccff",
        "icon": "microchip",
        "particle_color": "cyan"
    },
    "eco_sci": {
        "name": "ç”Ÿæ€ç§‘å¹»", 
        "color": "#00ff88", 
        "glow": "#44ff99",
        "icon": "seedling",
        "particle_color": "lime"
    },
    "space_opera": {
        "name": "å¤ªç©ºç§‘å¹»", 
        "color": "#8844ff", 
        "glow": "#aa66ff",
        "icon": "rocket",
        "particle_color": "purple"
    },
    "solarpunk": {
        "name": "å¤ªé˜³æœ‹å…‹", 
        "color": "#ffaa00", 
        "glow": "#ffcc44",
        "icon": "sun",
        "particle_color": "gold"
    }
}

# åˆ›å»ºé™å®šèŒƒå›´çš„ä¸­æ–‡åœ°å›¾
m = folium.Map(
    location=[22.543, 114.057],  # æ·±åœ³ä¸­å¿ƒåæ ‡
    zoom_start=12,
    tiles=None,  # å…ˆè®¾ä¸ºNoneï¼Œåé¢æ·»åŠ è‡ªå®šä¹‰ç“¦ç‰‡
    min_lat=SHENZHEN_BOUNDS["southwest"][0],
    max_lat=SHENZHEN_BOUNDS["northeast"][0],
    min_lon=SHENZHEN_BOUNDS["southwest"][1],
    max_lon=SHENZHEN_BOUNDS["northeast"][1],
    max_bounds=True,
    min_zoom=11,
    max_zoom=16
)

# æ·»åŠ é«˜å¾·åœ°å›¾ä¸­æ–‡åº•å›¾
folium.TileLayer(
    tiles='https://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}',
    attr='é«˜å¾·åœ°å›¾ - AutoNavi',
    name='é«˜å¾·åœ°å›¾',
    overlay=False,
    control=True
).add_to(m)

# æ·»åŠ æš—è‰²ç§‘å¹»åº•å›¾
folium.TileLayer(
    tiles='CartoDB dark_matter',
    attr='CartoDB',
    name='ç§‘å¹»æ¨¡å¼',
    overlay=False,
    control=True
).add_to(m)

# æ·»åŠ è‡ªå®šä¹‰CSSå’ŒJavaScript - ç§‘å¹»åŠ¨æ•ˆ
custom_css_js = """
<style>
    /* å…¨å±€ç§‘å¹»é£æ ¼ */
    .leaflet-container {
        background: #0a0a0f !important;
        font-family: 'Consolas', 'Monaco', monospace;
    }
    
    /* è„‰å†²åŠ¨ç”» */
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.7; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes glow {
        0%, 100% { box-shadow: 0 0 5px currentColor; }
        50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
    }
    
    /* éœ“è™¹è¾¹æ¡†åŠ¨ç”» */
    @keyframes neon-border {
        0%, 100% { border-color: #00ffff; box-shadow: 0 0 10px #00ffff; }
        25% { border-color: #ff00ff; box-shadow: 0 0 10px #ff00ff; }
        50% { border-color: #ffff00; box-shadow: 0 0 10px #ffff00; }
        75% { border-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
    }
    
    /* ç§‘å¹»æ ‡è®°æ ·å¼ */
    .leaflet-marker-icon {
        filter: drop-shadow(0 0 10px currentColor);
        animation: pulse 2s infinite;
    }
    
    /* è¿æ¥çº¿åŠ¨ç”» */
    .connection-line {
        stroke-dasharray: 5,5;
        animation: dash 2s linear infinite;
    }
    
    @keyframes dash {
        to { stroke-dashoffset: -10; }
    }
    
    /* ç²’å­æ•ˆæœèƒŒæ™¯ */
    #particle-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }
    
    /* å…¨æ¯æŠ•å½±æ•ˆæœ */
    .hologram {
        background: linear-gradient(45deg, transparent 30%, rgba(0,255,255,0.1) 50%, transparent 70%);
        animation: hologram-scan 3s linear infinite;
    }
    
    @keyframes hologram-scan {
        0% { background-position: -100px 0; }
        100% { background-position: 100px 0; }
    }
</style>

<!-- ç²’å­æ•ˆæœcanvas -->
<canvas id="particle-canvas"></canvas>

<script>
// ç²’å­ç³»ç»Ÿ
class ParticleSystem {
    constructor() {
        this.canvas = document.getElementById('particle-canvas');
        this.ctx = this.canvas.getContext('2d');
        this.particles = [];
        this.resize();
        this.init();
        window.addEventListener('resize', () => this.resize());
    }
    
    resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
    }
    
    init() {
        for(let i = 0; i < 50; i++) {
            this.particles.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5,
                life: Math.random(),
                color: ['#00ffff', '#ff00ff', '#ffff00', '#00ff88'][Math.floor(Math.random() * 4)]
            });
        }
        this.animate();
    }
    
    animate() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        this.particles.forEach((p, i) => {
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.002;
            
            if(p.life <= 0 || p.x < 0 || p.x > this.canvas.width || p.y < 0 || p.y > this.canvas.height) {
                this.particles[i] = {
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    life: 1,
                    color: ['#00ffff', '#ff00ff', '#ffff00', '#00ff88'][Math.floor(Math.random() * 4)]
                };
            }
            
            this.ctx.save();
            this.ctx.globalAlpha = p.life * 0.5;
            this.ctx.fillStyle = p.color;
            this.ctx.shadowBlur = 10;
            this.ctx.shadowColor = p.color;
            this.ctx.fillRect(p.x, p.y, 2, 2);
            this.ctx.restore();
        });
        
        requestAnimationFrame(() => this.animate());
    }
}

// åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ
document.addEventListener('DOMContentLoaded', () => {
    new ParticleSystem();
});

// åœ°æ ‡è¿æ¥çº¿åŠ¨ç”»
function drawConnectionLines() {
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.style.position = 'absolute';
    svg.style.top = '0';
    svg.style.left = '0';
    svg.style.width = '100%';
    svg.style.height = '100%';
    svg.style.pointerEvents = 'none';
    svg.style.zIndex = '999';
    
    // è¿™é‡Œå¯ä»¥æ·»åŠ è¿æ¥åœ°æ ‡çš„åŠ¨ç”»çº¿æ¡
    document.body.appendChild(svg);
}

// å…¨æ¯æ‰«ææ•ˆæœ
function addHologramEffect() {
    const scanLine = document.createElement('div');
    scanLine.style.position = 'fixed';
    scanLine.style.top = '0';
    scanLine.style.left = '0';
    scanLine.style.width = '100%';
    scanLine.style.height = '2px';
    scanLine.style.background = 'linear-gradient(90deg, transparent, #00ffff, transparent)';
    scanLine.style.zIndex = '9999';
    scanLine.style.animation = 'scan-line 4s linear infinite';
    document.body.appendChild(scanLine);
    
    const style = document.createElement('style');
    style.textContent = `
        @keyframes scan-line {
            0% { top: 0; opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
    `;
    document.head.appendChild(style);
}

setTimeout(addHologramEffect, 1000);
</script>
"""

# æ·»åŠ ç§‘å¹»è¾¹ç•Œæ•ˆæœ
folium.Polygon(
    locations=[[SHENZHEN_BOUNDS["southwest"][0], SHENZHEN_BOUNDS["southwest"][1]],
               [SHENZHEN_BOUNDS["southwest"][0], SHENZHEN_BOUNDS["northeast"][1]], 
               [SHENZHEN_BOUNDS["northeast"][0], SHENZHEN_BOUNDS["northeast"][1]],
               [SHENZHEN_BOUNDS["northeast"][0], SHENZHEN_BOUNDS["southwest"][1]]],
    color='#00ffff',
    weight=3,
    opacity=0.8,
    fill=True,
    fillColor='#001122',
    fillOpacity=0.1,
    className='neon-border'
).add_to(m)

# å¢å¼ºç‰ˆ3Dæ¨¡å‹æ¨¡æ¿
threejs_template = """
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<div id="3d-container-{id}" style="width:100%;height:250px;background:linear-gradient(45deg, #001122, #002244);border-radius:10px;overflow:hidden;position:relative;"></div>
<div style="position:absolute;top:10px;right:10px;color:{color};font-size:12px;font-family:monospace;">â–ˆ HOLOGRAM ACTIVE</div>
<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 300/250, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({{antialias:true, alpha:true}});
    renderer.setSize(300, 250);
    renderer.setClearColor(0x000000, 0);
    document.getElementById('3d-container-{id}').appendChild(renderer.domElement);
    
    // ç§‘å¹»åœºæ™¯è®¾ç½®
    scene.fog = new THREE.Fog(0x001122, 1, 100);
    
    // å¤šå½©ç¯å…‰ç³»ç»Ÿ
    const ambientLight = new THREE.AmbientLight(0x{color_hex}, 0.3);
    scene.add(ambientLight);
    
    const pointLight1 = new THREE.PointLight(0x{color_hex}, 1, 100);
    pointLight1.position.set(10, 10, 10);
    scene.add(pointLight1);
    
    const pointLight2 = new THREE.PointLight(0x{glow_hex}, 0.8, 100);
    pointLight2.position.set(-10, -10, 10);
    scene.add(pointLight2);
    
    // åˆ›å»ºå…¨æ¯ç½‘æ ¼
    const geometry = new THREE.BoxGeometry(2, 3, 2);
    const material = new THREE.MeshLambertMaterial({{
        color: 0x{color_hex},
        wireframe: true,
        transparent: true,
        opacity: 0.8
    }});
    const cube = new THREE.Mesh(geometry, material);
    scene.add(cube);
    
    // æ·»åŠ ç²’å­ç³»ç»Ÿ
    const particleGeometry = new THREE.BufferGeometry();
    const particleCount = 100;
    const positions = new Float32Array(particleCount * 3);
    
    for(let i = 0; i < particleCount * 3; i++) {{
        positions[i] = (Math.random() - 0.5) * 20;
    }}
    
    particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    
    const particleMaterial = new THREE.PointsMaterial({{
        color: 0x{glow_hex},
        size: 0.1,
        transparent: true,
        opacity: 0.6
    }});
    
    const particles = new THREE.Points(particleGeometry, particleMaterial);
    scene.add(particles);
    
    camera.position.z = 8;
    
    // åŠ¨ç”»å¾ªç¯
    let time = 0;
    function animate() {{
        requestAnimationFrame(animate);
        time += 0.01;
        
        cube.rotation.x = Math.sin(time) * 0.5;
        cube.rotation.y = time;
        cube.rotation.z = Math.cos(time) * 0.3;
        
        particles.rotation.y = time * 0.5;
        
        // åŠ¨æ€æè´¨æ•ˆæœ
        cube.material.opacity = 0.5 + Math.sin(time * 2) * 0.3;
        
        renderer.render(scene, camera);
    }}
    animate();
</script>
"""

# æ‰©å±•ç§‘å¹»åœ°æ ‡æ•°æ®
sci_fi_data = [
    {
        "id": "tencent",
        "name": "è…¾è®¯æ»¨æµ·å¤§å¦",
        "location": [22.523, 113.946],
        "description": "æ•°å­—å¸å›½çš„ç¥ç»ä¸­æ¢ï¼Œç»ç’ƒå¹•å¢™å†…æµæ·Œç€å…¨çƒæ•°æ®æµã€‚æ¯å½“å¤œå¹•é™ä¸´ï¼Œå¤§å¦è¡¨é¢çš„LEDé˜µåˆ—ä¼šæ˜¾ç¤ºå®æ—¶çš„å…¨çƒç½‘ç»œæ´»åŠ¨ï¼Œå®›å¦‚èµ›åšç©ºé—´çš„å¿ƒè·³ã€‚",
        "category": "cyberpunk",
        "literature": [
            {
                "title": "ã€Šç¥ç»æ¼«æ¸¸è€…Â·æ·±åœ³ã€‹",
                "excerpt": "å½“ä»–çš„æ„è¯†æ½œå…¥è…¾è®¯å¤§å¦çš„æ•°æ®æµ·æ´‹ï¼Œæ‰å‘ç°è‡ªå·±åªæ˜¯ç¼¸ä¸­ä¹‹è„‘ï¼Œè€ŒçœŸå®çš„æ·±åœ³æ—©å·²è¢«ç®—æ³•é‡æ„...",
                "category": "cyberpunk",
                "link": "#",
                "author": "é™ˆæ¥¸å¸†"
            }
        ]
    },
    {
        "id": "dajiang",
        "name": "å¤§ç–†å¤©ç©ºä¹‹åŸ",
        "location": [22.583, 113.985],
        "description": "æ— äººæœºèœ‚å·¢æ€»éƒ¨ï¼Œå»ºç­‘è¡¨é¢å¯†å¸ƒç€æ™ºèƒ½èµ·é™å¹³å°ã€‚æ¯å¤©æœ‰æ•°ä¸‡æ¶æ¬¡æ— äººæœºåœ¨æ­¤é›†ç»“ï¼Œå½¢æˆå£®è§‚çš„æœºæ¢°é¸Ÿç¾¤è¿å¾™ã€‚",
        "category": "space_opera",
        "literature": [
            {
                "title": "ã€Šèœ‚ç¾¤æ€ç»´ã€‹",
                "excerpt": "ç¬¬207ä»£æ— äººæœºå·²ç»è¿›åŒ–å‡ºé›†ä½“æ„è¯†ï¼Œå®ƒä»¬åœ¨å¤©ç©ºä¹‹åŸçš„é‡å­è®¡ç®—ä¸­å¿ƒæŠ•ç¥¨å†³å®šäººç±»çš„å‘½è¿...",
                "category": "space_opera",
                "link": "#",
                "author": "åˆ˜æ…ˆæ¬£"
            }
        ]
    },
    {
        "id": "green_tower",
        "name": "æ·±åœ³ç»¿è‰²é‡‘èä¸­å¿ƒ",
        "location": [22.541, 114.025],
        "description": "å‚ç›´æ£®æ—å»ºç­‘ï¼Œå¤–ç«‹é¢å®Œå…¨è¢«åŸºå› æ”¹é€ æ¤ç‰©è¦†ç›–ã€‚è¿™äº›æ¤ç‰©ä¸ä»…èƒ½å‡€åŒ–ç©ºæ°”ï¼Œè¿˜èƒ½è¿›è¡Œå…‰åˆä½œç”¨å‘ç”µï¼Œæ˜¯ç”Ÿæ€ä¿®å¤è®¡åˆ’çš„ç¥ç»ä¸­æ¢ã€‚",
        "category": "eco_sci",
        "literature": [
            {
                "title": "ã€Šå…‰åˆåŸå¸‚ã€‹",
                "excerpt": "æœ€åçš„æ¤ç‰©å­¦å®¶åœ¨é‡‘èä¸­å¿ƒçš„ç”Ÿç‰©å®éªŒå®¤é‡ŒåŸ¹è‚²ç€èƒ½å¤Ÿå¸æ”¶æ ¸è¾å°„çš„è¶…çº§è‹”è—“ï¼Œé‚£æ˜¯æ‹¯æ•‘åœ°çƒçš„æœ€åå¸Œæœ›...",
                "category": "eco_sci",
                "link": "#",
                "author": "éŸ©æ¾"
            }
        ]
    },
    {
        "id": "ping_an",
        "name": "å¹³å®‰é‡‘èä¸­å¿ƒ",
        "location": [22.538, 114.053],
        "description": "è¿™åº§599ç±³çš„æ‘©å¤©å¤§æ¥¼è¢«ç§°ä¸º'å¤ªé˜³èƒ½å¡”'ï¼Œæ•´ä¸ªå»ºç­‘è¡¨é¢è¦†ç›–ç€æœ‰æœºå¤ªé˜³èƒ½è–„è†œï¼Œåœ¨é˜³å…‰ç…§å°„ä¸‹é—ªé—ªå‘å…‰ï¼Œå¦‚åŒä¸€æ ¹é€šå¤©çš„èƒ½é‡æŸ±ã€‚",
        "category": "solarpunk",
        "literature": [
            {
                "title": "ã€Šèƒ½æºä¹‹å¡”ã€‹",
                "excerpt": "å½“å¤ªé˜³é£æš´è¢­å‡»åœ°çƒæ—¶ï¼Œåªæœ‰å¹³å®‰å¤§å¦çš„å¤ªé˜³èƒ½æ ¸å¿ƒä»åœ¨è¿è½¬ï¼Œä¸ºæ•´ä¸ªæ·±åœ³æä¾›ç€ç”Ÿå‘½ä¹‹å…‰...",
                "category": "solarpunk",
                "link": "#",
                "author": "ç‹æ™‹åº·"
            }
        ]
    },
    {
        "id": "huawei",
        "name": "åä¸ºå‚ç”°åŸºåœ°",
        "location": [22.628, 114.069],
        "description": "è¿™ä¸ªè¢«ç§°ä¸º'æºªæ‘'çš„å»ºç­‘ç¾¤éšè—ç€å…¨çƒæœ€å…ˆè¿›çš„6Gé€šä¿¡å®éªŒå®¤ï¼Œæ®è¯´èƒ½å¤Ÿå®ç°æ„è¯†ä¼ è¾“å’Œæ—¶é—´é€šä¿¡ã€‚",
        "category": "cyberpunk",
        "literature": [
            {
                "title": "ã€Šé‡å­çº ç¼ ã€‹",
                "excerpt": "åä¸ºçš„ç§‘å­¦å®¶ä»¬åœ¨å‚ç”°åŸºåœ°æˆåŠŸå»ºç«‹äº†ä¸ç«æ˜Ÿçš„é‡å­é€šä¿¡é“¾è·¯ï¼Œå´æ„å¤–æ”¶åˆ°äº†æ¥è‡ªæœªæ¥çš„è­¦å‘Š...",
                "category": "cyberpunk", 
                "link": "#",
                "author": "ä½•å¤•"
            }
        ]
    },
    {
        "id": "mangrove",
        "name": "çº¢æ ‘æ—ç”Ÿæ€å…¬å›­",
        "location": [22.524, 113.954],
        "description": "è¿™ç‰‡äººå·¥åŸ¹è‚²çš„çº¢æ ‘æ—ä¸å†æ˜¯æ™®é€šæ¤ç‰©ï¼Œè€Œæ˜¯å…·æœ‰ç”Ÿç‰©è®¡ç®—èƒ½åŠ›çš„æ´»ä½“è®¡ç®—æœºç¾¤è½ï¼Œèƒ½å¤Ÿé¢„æµ‹ç¯å¢ƒå˜åŒ–å¹¶è‡ªæˆ‘è¿›åŒ–ã€‚",
        "category": "eco_sci",
        "literature": [
            {
                "title": "ã€Šç»¿è‰²å¤§è„‘ã€‹",
                "excerpt": "çº¢æ ‘æ—çš„æ ¹ç³»å·²ç»å½¢æˆäº†å·¨å¤§çš„ç”Ÿç‰©ç¥ç»ç½‘ç»œï¼Œå®ƒä»¬å¼€å§‹æ€è€ƒï¼Œå¹¶å‘äººç±»å‘å‡ºäº†ç¬¬ä¸€ä¸ªä¿¡æ¯...",
                "category": "eco_sci",
                "link": "#",
                "author": "éƒæ™¯èŠ³"
            }
        ]
    }
]

# å¢å¼ºç‰ˆå¼¹çª—CSSæ ·å¼
popup_css = f"""
<style>
    .popup-container {{
        width: 420px;
        font-family: 'Consolas', 'Monaco', monospace;
        background: linear-gradient(135deg, #001122 0%, #002244 100%);
        color: #00ffff;
        border: 2px solid #00ffff;
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(0,255,255,0.5), inset 0 0 30px rgba(0,255,255,0.1);
        animation: glow 2s ease-in-out infinite alternate;
        position: relative;
        overflow: hidden;
    }}
    
    .popup-container::before {{
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00, #00ff00);
        border-radius: 15px;
        z-index: -1;
        animation: neon-border 4s linear infinite;
    }}
    
    .popup-content {{
        padding: 20px;
        position: relative;
        z-index: 1;
        background: rgba(0, 17, 34, 0.95);
        border-radius: 13px;
    }}
    
    .building-header {{
        border-left: 5px solid #00ffff;
        padding-left: 15px;
        margin-bottom: 20px;
        position: relative;
    }}
    
    .building-header::before {{
        content: 'â–ˆ SCANNING...';
        position: absolute;
        top: -20px;
        right: 0;
        font-size: 10px;
        color: #00ff88;
        animation: blink 1s infinite;
    }}
    
    @keyframes blink {{
        0%, 50% {{ opacity: 1; }}
        51%, 100% {{ opacity: 0; }}
    }}
    
    .building-title {{
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 8px;
        text-shadow: 0 0 10px currentColor;
        background: linear-gradient(45deg, #00ffff, #00ccff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }}
    
    .category-tag {{
        display: inline-block;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 11px;
        margin-right: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 1px solid;
        background: rgba(0,0,0,0.3);
        box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
    }}
    
    .building-desc {{
        font-size: 14px;
        line-height: 1.8;
        margin-bottom: 20px;
        text-align: justify;
        background: rgba(0,255,255,0.05);
        padding: 15px;
        border-radius: 10px;
        border-left: 3px solid #00ffff;
    }}
    
    .literature-section {{
        margin-top: 20px;
        padding-top: 15px;
        position: relative;
    }}
    
    .literature-section::before {{
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, #00ffff, transparent);
    }}
    
    .literature-title {{
        font-size: 16px;
        font-weight: bold;
        color: #00ff88;
        margin-bottom: 15px;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 2px;
    }}
    
    .literature-item {{
        margin-bottom: 15px;
        padding: 15px;
        border-radius: 10px;
        background: rgba(0,0,0,0.4);
        border: 1px solid;
        position: relative;
        transition: all 0.3s ease;
    }}
    
    .literature-item:hover {{
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,255,255,0.3);
    }}
    
    .literature-item-title {{
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 15px;
    }}
    
    .literature-excerpt {{
        font-size: 13px;
        color: #cccccc;
        font-style: italic;
        margin: 10px 0;
        line-height: 1.6;
        border-left: 2px solid #444;
        padding-left: 10px;
    }}
    
    .author {{
        font-size: 11px;
        color: #888;
        text-align: right;
        margin-top: 5px;
    }}
    
    .read-link {{
        color: #00ffff;
        font-size: 12px;
        text-decoration: none;
        border: 1px solid #00ffff;
        padding: 3px 8px;
        border-radius: 5px;
        display: inline-block;
        transition: all 0.3s ease;
    }}
    
    .read-link:hover {{
        background: #00ffff;
        color: #001122;
        box-shadow: 0 0 10px #00ffff;
    }}
    
    /* åˆ†ç±»é¢œè‰²å®šä¹‰ */
    .cyberpunk {{ 
        border-color: {SCIFI_CATEGORIES['cyberpunk']['color']}; 
        background: {SCIFI_CATEGORIES['cyberpunk']['color']}10;
    }}
    .eco_sci {{ 
        border-color: {SCIFI_CATEGORIES['eco_sci']['color']}; 
        background: {SCIFI_CATEGORIES['eco_sci']['color']}10;
    }}
    .space_opera {{ 
        border-color: {SCIFI_CATEGORIES['space_opera']['color']}; 
        background: {SCIFI_CATEGORIES['space_opera']['color']}10;
    }}
    .solarpunk {{ 
        border-color: {SCIFI_CATEGORIES['solarpunk']['color']}; 
        background: {SCIFI_CATEGORIES['solarpunk']['color']}10;
    }}
</style>
"""

# æ·»åŠ åœ°æ ‡åˆ°åœ°å›¾
for landmark in sci_fi_data:
    # è·å–åˆ†ç±»é…ç½®
    category = SCIFI_CATEGORIES[landmark["category"]]
    
    # 3Då±•ç¤ºå†…å®¹
    visual_content = threejs_template.format(
        id=landmark["id"],
        color=category["color"],
        color_hex=category["color"][1:],
        glow_hex=category["glow"][1:]
    )
    
    # æ–‡å­¦ä½œå“åˆ—è¡¨
    literature_html = ""
    for work in landmark["literature"]:
        work_category = SCIFI_CATEGORIES[work["category"]]
        literature_html += f"""
        <div class="literature-item {work['category']}">
            <div class="literature-item-title">
                <span class="category-tag" style="color:{work_category['color']};border-color:{work_category['color']};">
                    {work_category['name']}
                </span>
                {work['title']}
            </div>
            <div class="literature-excerpt">"{work['excerpt']}"</div>
            <div class="author">â€”â€” {work['author']}</div>
            <a href="{work['link']}" class="read-link" style="border-color:{work_category['color']};color:{work_category['color']};">
                è¯»å–æ•°æ® â†’
            </a>
        </div>
        """
    
    # å®Œæ•´å¼¹çª—HTML
    html = f"""
    {popup_css}
    <div class="popup-container">
        <div class="popup-content">
            <div class="building-header" style="border-color:{category['color']};">
                <div class="building-title">{landmark['name']}</div>
                <span class="category-tag" style="color:{category['color']};border-color:{category['color']};">
                    {category['name']}
                </span>
            </div>
            <div class="building-desc">{landmark['description']}</div>
            {visual_content}
            <div class="literature-section">
                <div class="literature-title">å…³è”æ–‡å­¦æ¡£æ¡ˆ</div>
                {literature_html}
            </div>
        </div>
    </div>
    """
    
    # åˆ›å»ºå¼¹çª—
    iframe = IFrame(html, width=440, height=600)
    popup = folium.Popup(iframe, max_width=440)
    
    # æ·»åŠ å‘å…‰æ ‡è®°
    folium.Marker(
        location=landmark["location"],
        popup=popup,
        tooltip=f"â—‰ {landmark['name']} | {category['name']} â—‰",
        icon=folium.Icon(
            color='black',
            icon=category["icon"],
            prefix="fa"
        )
    ).add_to(m)
    
    # æ·»åŠ å‘å…‰åœ†åœˆæ•ˆæœ
    folium.Circle(
        location=landmark["location"],
        radius=300,
        color=category["color"],
        weight=2,
        opacity=0.8,
        fillColor=category["glow"],
        fillOpacity=0.2,
        className='pulse-circle'
    ).add_to(m)


# å¢å¼ºç‰ˆå›¾ä¾‹
legend_html = f"""
<div style="
    position: fixed; 
    bottom: 30px; 
    right: 15px;
    background: linear-gradient(135deg, #001122, #002244);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(0,255,255,0.5);
    z-index: 1000;
    font-family: 'Consolas', monospace;
    color: #00ffff;
    border: 2px solid #00ffff;
    min-width: 220px;
">
    <h4 style="margin:0 0 15px 0;text-align:center;font-size:14px;letter-spacing:2px;">LEGEND</h4>
    <div style="border-top:1px solid #333;margin-bottom:10px;"></div>
"""
# éå†ç±»åˆ«ï¼Œæ·»åŠ å›¾æ ‡ä¸åç§°
for cat_id, cat in SCIFI_CATEGORIES.items():
    legend_html += f"""
    <div style="margin-bottom:10px;display:flex;align-items:center;font-size:12px;">
        <div style="width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.2);
            display:flex;align-items:center;justify-content:center;
            box-shadow:0 0 8px {cat['color']};margin-right:10px;">
            <i class="fa fa-{cat['icon']}" style="color:{cat['color']};font-size:12px;"></i>
        </div>
        <span style="color:{cat['color']};">{cat['name']}</span>
    </div>
    """

legend_html += f"""
    <div style="border-top:1px solid #333;margin-top:10px;padding-top:10px;">
        <div style="font-size:10px;color:#888;text-align:center;">
            â—‰ NEURAL LINK ACTIVE â—‰
        </div>
    </div>
</div>
"""
m.get_root().html.add_child(folium.Element(legend_html))

# å¢å¼ºç‰ˆæ ‡é¢˜
title_html = """
<div style="
    position: fixed; 
    top: 15px; 
    left: 50%; 
    transform: translateX(-50%);
    background: linear-gradient(135deg, rgba(0,17,34,0.95), rgba(0,34,68,0.95));
    padding: 15px 35px;
    border-radius: 30px;
    box-shadow: 0 0 40px rgba(0,255,255,0.6);
    z-index: 1000;
    font-family: 'Consolas', monospace;
    font-size: 18px;
    font-weight: bold;
    color: #00ffff;
    border: 2px solid #00ffff;
    text-shadow: 0 0 10px #00ffff;
    letter-spacing: 3px;
    position: relative;
    overflow: hidden;
">
    <div style="position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;background:linear-gradient(45deg,#00ffff,#ff00ff,#ffff00,#00ff00);border-radius:30px;z-index:-1;animation:neon-border 4s linear infinite;"></div>
    <div style="position:relative;z-index:1;">
        <div style="font-size:22px;font-weight:bold;color:#00ffff;text-shadow:0 0 10px #00ffff;letter-spacing:2px;">
        â—‰ æ·±åœ³ç§‘å¹»æ–‡å­¦åœ°å›¾ â—‰
    </div>
    <div style="font-size:11px;color:#00ff88;margin-top:6px;letter-spacing:1px;">
        SHENZHEN SCI-FI LITERATURE MAPPING SYSTEM v1.0
        </div>
    </div>
</div>
"""
m.get_root().html.add_child(folium.Element(title_html))

# æ·»åŠ å›¾å±‚æ§åˆ¶å™¨è¯´æ˜
layer_control_note = """
<div style="
    position: fixed;
    top: 100px;
    right: 20px;
    background: rgba(0,17,34,0.9);
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #00ffff;
    font-family: 'Consolas', monospace;
    font-size: 10px;
    color: #00ffff;
    z-index: 1000;
    max-width: 150px;
">
    <div style="font-weight:bold;margin-bottom:8px;text-align:center;">åœ°å›¾åˆ‡æ¢</div>
    <div style="font-size:9px;line-height:1.4;">
        â€¢ é«˜å¾·åœ°å›¾ - ä¸­æ–‡æ ‡å‡†<br>
        â€¢ ç§‘å¹»æ¨¡å¼ - æš—è‰²ä¸»é¢˜
    </div>
</div>
"""
m.get_root().html.add_child(folium.Element(layer_control_note))
# çŠ¶æ€æŒ‡ç¤ºå™¨
status_html = """
<div style="
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0,17,34,0.9);
    padding: 10px 15px;
    border-radius: 20px;
    border: 1px solid #00ffff;
    font-family: 'Consolas', monospace;
    font-size: 11px;
    color: #00ffff;
    z-index: 1000;
">
    <div style="display:flex;align-items:center;">
        <div style="width:8px;height:8px;background:#00ff00;border-radius:50%;margin-right:8px;animation:blink 1s infinite;"></div>
        <span>ä¸­æ–‡åœ°å›¾å·²æ¿€æ´»</span>
    </div>
    <div style="margin-top:5px;font-size:9px;color:#888;">
        6ä¸ªèŠ‚ç‚¹å·²æ£€æµ‹
    </div>
</div>
"""
m.get_root().html.add_child(folium.Element(status_html))

# æ·»åŠ è‡ªå®šä¹‰CSSå’ŒJavaScript
m.get_root().html.add_child(folium.Element(custom_css_js))

#æ·»åŠ å›¾å±‚æ§åˆ¶å™¨
folium.LayerControl(position='topright', collapsed=False).add_to(m)

# ä¿å­˜åœ°å›¾
m.save("shenzhen_scifi_map_enhanced.html")
print("ğŸš€ å¢å¼ºç‰ˆç§‘å¹»åœ°å›¾å·²ç”Ÿæˆï¼")
print("ğŸ“ æ–‡ä»¶å: shenzhen_scifi_map_enhanced.html")
print("ğŸ¨ æ–°å¢ç‰¹æ•ˆ:")
print("   â€¢ éœ“è™¹ç¯è¾¹æ¡†åŠ¨ç”»")
print("   â€¢ èƒŒæ™¯ç²’å­ç³»ç»Ÿ") 
print("   â€¢ å…¨æ¯æ‰«ææ•ˆæœ")
print("   â€¢ å‘å…‰æ ‡è®°å’Œè¿æ¥çº¿")
print("   â€¢ èµ›åšæœ‹å…‹UIé£æ ¼")
print("   â€¢ 3Dæ¨¡å‹å±•ç¤º")
print("ğŸ”¥ ç”¨æµè§ˆå™¨æ‰“å¼€ä½“éªŒå®Œæ•´ç§‘å¹»æ•ˆæœï¼")
